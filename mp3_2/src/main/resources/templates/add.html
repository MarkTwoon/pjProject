<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增音乐数据</title>

    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Shards Dashboard Lite - Free Bootstrap Admin Template – DesignRevision</title>
    <meta name="description" content="A high-quality &amp; free Bootstrap admin dashboard template pack that comes with lots of templates and components.">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" id="main-stylesheet" data-version="1.1.0" href="css/styles/shards-dashboards.1.1.0.min.css">
    <link rel="stylesheet" href="css/styles/extras.1.1.0.min.css">
    <!--     <script async defer src="https://buttons.github.io/buttons.js"></script> -->
   <!-- <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/inputFileCSS/font-awesome.min.css">
    <link rel="stylesheet" href="/inputFileCSS/input-file.css">-->
    <!-- 为了渲染file按钮图形样式 引入assets文件夹下的外联资源  -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="/assets/css/input-file.css">
</head>
<body style="width:600px;height: 500px;margin-left: 10px;margin-top: 10px">

<!-- BootStap基准div 排版规则样式 -->
<div class="row"  id="row">

    <div class="col-lg-8" style="margin: 0 auto;">
        <div class="card card-small mb-4" >

            <!--div夹带样式  修饰标题  -->
            <div class="card-header border-bottom">
                <h6 class="m-0">新增歌曲</h6>
            </div>

            <ul class="list-group list-group-flush">
                <li class="list-group-item p-3">
                    <!--  ul中夹带form表单-->
                    <div class="row">
                        <div class="col">
                            ${error }
                            <form   id="form1" method="post"   enctype="multipart/form-data">

                                <!-- 几个修饰性div组成了input控件文本框 -->
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="feFirstName">歌曲名</label>
                                        <input type="text" class="form-control" id="mp3Name"   name="mp3Name"  placeholder="First Name"   onfocus="this.value = '';" >
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="feFirstName">歌手名</label>
                                        <input type="text" class="form-control" id="mp3Man"   name="mp3Man"  placeholder="SingerName"   onfocus="this.value = '';" >
                                    </div>
                                </div>

                                <!-- 几个修饰性div组成了input控件上传选择框 -->
                                <div class="form-group col-md-6">
                                    <div class="form-group col-md-6">
                                        <label for="feFirstName">歌手  </label>
                                        <!--<input type="file" class="form-control"  onchange="uploadCheck(this,'mp3ManImg','jpg','png');"  name="mp3ManImg"  id="mp3ManImg"  value="Sierra">-->

                                        <!-- 几个修饰性div组成了input控件文本框  按钮美化-->
                                        <div class="custom-file-input-style-rounded">
                                            <div class="custom-file-btn-wrap">
                                                <span class="custom-file-browse"><i class="fa fa-cloud-upload" aria-hidden="true"></i></span>
                                                <input class="custom-file-input-browse" id="mp3ManImg" type="file" onchange="uploadCheck(this,'mp3ManImg','jpg','png');" name="mp3ManImg"   value="Sierra">
                                            </div>
                                             <input class="form-control" id="textmp3ManImg" placeholder="请上传您的图片文件" type="text" readonly="readonly">
                                        </div>

                                    </div>
                                </div>


                                <div class="form-group col-md-6"   >
                                    <div class="form-group col-md-6">
                                        <label for="feFirstName">歌曲  </label>
                                        <!--<input type="file" class="form-control" onchange="uploadCheck(this,'mp3Src','mp3','wav');"   name="mp3Src" id="mp3Src"   value="Sierra">-->

                                        <!-- 几个修饰性div组成了input控件文本框  按钮美化-->
                                        <div class="custom-file-input-style-rounded bg-linear-color">
                                            <div class="custom-file-btn-wrap">
                                                <span class="custom-file-browse"><i class="fa fa-upload" aria-hidden="true"></i></span>
                                                <input class="custom-file-input-browse" id="mp3Src"   name="mp3Src"  onchange="uploadCheck(this,'mp3Src','mp3','wav');"  value="Sierra" type="file">
                                            </div>
                                              <input class="form-control" id="textmp3Src" placeholder="请上传您的音频文件" type="text" readonly="readonly">
                                        </div>


                                    </div>
                                </div>


                                <button type="button" onclick="insertMp3();" class="btn btn-accent">点击新增</button>
                            </form>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- End Default Light Table -->
</div>
</body>

<script src="/js/layui/layui.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript">
function  uploadCheck(file,fileId,pageName1,pageName2) {
    /*jquery  获取上传文件后缀名*/
    var filePageName = ($("#"+fileId).val().substring($("#"+fileId).val().lastIndexOf(".")+1,$("#"+fileId).val().length)).toLowerCase();

    /*获取上传文件后缀名*/
   // var filePageName=(file.files[0]+'')!='undefined'?file.files[0].type.substring(file.files[0].type.lastIndexOf("/")+1).toLowerCase():'';
    if(filePageName!=pageName1&&filePageName!=pageName2){
      file.value='';
        layui.use(['laypage','layer','laydate'],function () {
            layer.msg('抱歉，上传文件类型不符合标准格式');
        });
    }else{
        layui.use(['laypage','layer','laydate'],function () {
            layer.msg('选择文件格式正确！',{icon:"6"});
        });
    }
    $("#text"+fileId).val($("#"+fileId).val());
}

function insertMp3() {
    if($("#mp3ManImg").val()==''||$("#mp3Src").val()==''){
        layui.use(['laypage','layer','laydate'],function () {
            layer.msg('抱歉，您并未上传2个完整的歌曲及封面文件');
        });
    }else{
        /*   axios..... 异步直接上传过程！！*/
        /*利用formData把指定的form表单数据 转换成json格式
        *  form表单有file文件标签 要进行文件上传
        * 所以enctype="multipart/form-data"属性 也要有*/
         var form1=document.getElementById("form1");
        var formData=new FormData(form1);
        /*注意 前后端 访问与外联引入路径 采用根相对路径
        * 仅限于 微服务及分布式框架环境下*/
         axios.post('/admin/uploadMp3',formData).then(function (response) {
          if(response.data){
              layui.use(['laypage','layer','laydate'],function () {
                  parent.layer.closeAll('iframe');
                  parent.layer.msg('新增操作正确！',{icon:"6"});
              });
              /*子弹出层页面  利用window.parent 返回上一级父页面
              * 调用父页面 js函数体*/
              window.parent.index(1,5);
          }else{
              layui.use(['laypage','layer','laydate'],function () {
                  parent.layer.msg('抱歉，新增文件数据操作失败！');
              });
          }

         });
    }
}

</script>
</html>